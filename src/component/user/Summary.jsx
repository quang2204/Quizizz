import React, { useState } from "react";
import { useSelector } from "react-redux";
import hh from "../../../img/hh.png";
import { useLocation } from "react-router-dom";
import _ from "lodash";
const Summary = () => {
  const isquizz = useSelector((state) => state.user.quizResult);
  const totalpt = (isquizz.countCorrect / isquizz.countTotal) * 100;
  const roundedNumber = Math.round(totalpt);
  const total = isquizz.countCorrect * 100;
  const totals = 100 - roundedNumber;
  const causai = isquizz.countTotal - isquizz.countCorrect;
  let location = useLocation();
  const data = location.state;
  console.log(isquizz.quizData);
  console.log(data);
  return (
    <div style={{ backgroundColor: "#461a42" }} className="text-white">
      <div
        style={{ backgroundColor: "#00000080" }}
        className="max-w-[528px] m-auto px-2 pt-6 "
      >
        <div className="text-center text-base font-medium">Bản tóm tắt</div>
        <h3 className="text-xl font-bold text-center pt-4 pb-6">
          Your Progress Matters!
        </h3>
        <div className="max-w-[480px] m-auto">
          <div className="flex items-center gap-3">
            <div className="bg-black px-3 rounded-2xl">
              <span className="mb-3 pt-1 w-[260px] max-[505px]:w-[200px] block overflow-hidden text-xl max-[505px]:mb-2 max-[430px]:w-[150px] ">
                me
              </span>

              <div className="flex pt-[12px] max-[505px]:pb-[10px]  max-[505px]:pt-2 pb-[28px] items-center ">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 32 31"
                  className="z-[1] w-8"
                >
                  <g clipPath="url(#a)">
                    <path
                      fill="#E1713C"
                      d="M27.047 3.398a12.344 12.344 0 0 0-3.32-2.084A14.337 14.337 0 0 0 22.3.765l-8.515 13.482c-2.854 4.574-5.85 8.97-8.703 13.545.25.207.769.68 1.253.995 4.288 2.793 9.342 2.198 10.371 2.077 8.12-.956 12.4-8.04 12.581-8.352 3.67-6.302 2.67-14.761-2.241-19.114Z"
                    ></path>
                    <path
                      fill="#EEAD42"
                      d="M23.845 1.475c6.724 3.444 8.219 12.57 3.55 20.146-4.67 7.577-14.01 10.848-20.734 7.232C.124 25.237-1.558 16.283 3.3 8.707 7.969 1.13 17.308-2.141 23.845 1.475Z"
                    ></path>
                    <path
                      fill="#DE8E3E"
                      d="M23.526 19.232C20 24.757 13.302 27.357 8.543 24.757c-4.583-2.438-5.641-8.938-2.116-14.625 3.526-5.525 10.048-7.963 14.807-5.525.357.182.692.389 1.005.617 1.497 1.09 2.492 2.671 2.97 4.497.754 2.886.214 6.38-1.683 9.51Z"
                    ></path>
                    <path
                      fill="#CD5F36"
                      d="M12.232 25.761c-1.299-.128-3.298-.468-4.957-1.85-2.02-1.683-2.97-4.271-2.944-6.934.023-2.464.897-4.992 2.096-6.97C8.843 6.02 13.673 3.35 17.665 3.651c3.12.235 4.626 1.618 4.626 1.618 1.036.75 1.62 1.573 1.981 2.138-.769-.584-3.617-2.58-7.478-2.323-5.454.361-8.263 4.9-8.78 5.734-1.829 2.954-3.01 7.835-.265 11.605 1.402 1.927 3.336 2.885 4.483 3.337Z"
                    ></path>
                    <path
                      fill="#FFE7CA"
                      d="M7.491 6.16c.925-.963 2.363-2.117 4.248-2.998L7.49 6.16Z"
                    ></path>
                    <path
                      fill="#FFDEAD"
                      d="M8.673 7.27c.565-.525 1.222-1.028 1.87-1.499-.116.085 1.2-.75 2.063-1.155.37-.174.682-.66.789-1.026.113-.386.062-.9-.173-1.243-.237-.344-.589-.647-1.027-.741-.467-.1-.893-.07-1.323.132-1.007.473-1.924 1.088-2.81 1.736-.64.468-1.257.985-1.8 1.55-.306.317-.488.701-.488 1.136 0 .396.187.869.503 1.14.328.283.757.494 1.215.473.683-.03 1.181-.503 1.181-.503Zm-4.038 4.064c.93 0 1.682-.707 1.682-1.58 0-.872-.753-1.579-1.682-1.579-.929 0-1.682.707-1.682 1.58 0 .872.753 1.58 1.682 1.58Z"
                    ></path>
                    <path
                      fill="#fff"
                      d="m8.224 4.25.929-.438a.164.164 0 0 0 0-.302l-.93-.437a1.4 1.4 0 0 1-.644-.605l-.465-.872a.186.186 0 0 0-.322 0l-.464.872a1.4 1.4 0 0 1-.645.605l-.929.437a.164.164 0 0 0 0 .302l.93.437a1.4 1.4 0 0 1 .644.605l.464.873a.186.186 0 0 0 .322 0l.465-.873a1.4 1.4 0 0 1 .644-.605Z"
                    ></path>
                    <path
                      fill="#FFD597"
                      d="M26.418 8.69c.588 1.981.727 3.976.412 5.93-.401 2.483-1.536 4.871-3.283 6.908-1.655 1.93-3.808 3.445-6.06 4.267-.782.284-2.404.877-4.526.877-.52 0-1.07-.036-1.646-.12-.982-.145-2.95-.863-2.984-.896l-2.659 2.596c-1.57-1.106-2.753-2.459-3.599-4.025l3.165-2.95a7.444 7.444 0 0 0 3.313 3.473c.14.076 1.341.768 2.895.92 2.715.265 4.506-.289 5.643-.859 2.388-1.198 3.916-2.266 5.398-4.148 1.767-2.243 1.996-3.103 2.486-5.5.196-.953.562-2.409.556-3.256-.008-1.17-.36-2.336-.36-2.336-.477-1.825-1.447-3.273-2.944-4.362l3.108-2.827a10.817 10.817 0 0 1 3.402 3.994l-2.322 2.298.005.016Zm-22.04 9.467L.942 21.384c.117.451.257.893.42 1.324l3.271-3.072a9.94 9.94 0 0 1-.255-1.479ZM20.817 4.405l3.056-2.87-.061-.032c-.374-.206-.756-.39-1.147-.552l-3.217 2.99c.456.118.935.272 1.369.465Z"
                    ></path>
                    <path
                      fill="#D45C27"
                      d="M19.011 19.4c.094-.067.206-.184.429-.417.096-.102.323-.34.544-.604.737-.885 1.203-1.796 1.203-1.796.168-.328.372-.778.544-1.332.11-.356.28-.914.33-1.672a6.402 6.402 0 0 0-.115-1.715c-.078-.37-.181-.847-.482-1.411-.206-.386-.604-1.132-1.284-1.47-.117-.058-.46-.213-.754-.34-.196-.084-.376-.17-.504-.211a4.678 4.678 0 0 0-1.426-.243c-.517.001-1.008.034-1.506.165-.528.14-1.032.304-1.515.552a9.09 9.09 0 0 0-1.445.907c-.469.367-.901.782-1.295 1.221a8.732 8.732 0 0 0-.963 1.297c-.33.543-.632 1.096-.849 1.69-.122.335-.215.677-.301 1.022a5.931 5.931 0 0 0-.191 1.402c-.004.323.001.648.039.97a4.3 4.3 0 0 0 .116.609c.078.29.166.583.29.86.034.076.176.38.449.768.165.234.462.657.932 1.04.17.137 1.334 1.062 2.363.872.303-.056.71-.23.91-.374.11-.08.217-.178.217-.178.083-.078.15-.15.198-.208a.805.805 0 0 0 .172-.276.793.793 0 0 0 .045-.288c-.01-.452-.373-.868-.381-.883-.21-.252-.472-.356-.736-.462a24.006 24.006 0 0 0-.187-.065s-.73-.472-1.06-.927c-.446-.618-.292-1.393-.13-2.207a6.05 6.05 0 0 1 .747-1.904c.307-.534.79-1.354 1.772-2.065 0 0 1.018-.736 2.266-.916.573-.083.855.024 1.017.129.162.104.309.272.31.27.002-.001-.252-.233-.24-.221.19.176.353.375.49.59l-.171-.272c.163.26.287.537.377.825l-.095-.308c.121.396.179.805.188 1.216l-.007-.331c.01.56-.068 1.117-.212 1.659l.085-.322a7.827 7.827 0 0 1-.84 1.967l.165-.278c-.386.646-.513.902-1.06 1.434l.233-.224a8.45 8.45 0 0 1-.556.492c-.259.21-.443.497-.483.824a.89.89 0 0 0 .055.486c.034.158.107.3.22.426.35.393.87.465.87.465.687.072 1.046-.118 1.212-.237Z"
                    ></path>
                    <path
                      fill="#EEAD42"
                      d="M18.468 18.55c.3-.287.59-.601.873-.943.428-.52.791-1.09 1.108-1.678a7.73 7.73 0 0 0 .602-1.441c.168-.561.305-1.133.345-1.717a7.867 7.867 0 0 0-.002-.983 4.57 4.57 0 0 0-.078-.628 6.082 6.082 0 0 0-.254-.883 3.431 3.431 0 0 0-.25-.54 4.84 4.84 0 0 0-.495-.731 4.635 4.635 0 0 0-.643-.613 4.58 4.58 0 0 0-.747-.457 3.082 3.082 0 0 0-.504-.211 4.678 4.678 0 0 0-1.426-.243c-.516.001-1.008.034-1.505.165-.529.14-1.033.304-1.516.552-.508.26-.998.559-1.444.907-.47.367-.902.783-1.296 1.221a8.73 8.73 0 0 0-.963 1.297c-.33.543-.631 1.096-.848 1.69-.122.335-.215.678-.302 1.022a6.43 6.43 0 0 0-.139.712c-.03.23-.049.46-.052.69a7.48 7.48 0 0 0 .04.97c.024.205.061.408.115.609.078.29.166.583.29.86.122.269.282.523.45.768.108.16.232.31.37.446.211.208.43.414.68.579.32.211.675.4 1.046.517.382.12.791.129 1.193.153.345.02.68-.047.957-.254a.926.926 0 0 0 .314-.364.896.896 0 0 0 .169-.46c.023-.32-.047-.66-.274-.912-.219-.24-.526-.444-.87-.465-.217-.013-.44.039-.65-.012l.338.084a3.195 3.195 0 0 1-.732-.28l.294.16a3.04 3.04 0 0 1-.602-.431l.238.222a3.078 3.078 0 0 1-.49-.59l.172.271a3.5 3.5 0 0 1-.377-.825l.095.309a4.488 4.488 0 0 1-.188-1.216l.007.331a6.05 6.05 0 0 1 .212-1.659l-.085.321a7.84 7.84 0 0 1 .84-1.966l-.165.278a8.776 8.776 0 0 1 1.402-1.777l-.232.225a7.838 7.838 0 0 1 1.557-1.179l-.285.162c.45-.256.93-.464 1.436-.602l-.324.088c.374-.1.759-.16 1.148-.166l-.349.004a3.69 3.69 0 0 1 .91.1l-.337-.083c.254.064.498.156.727.279l-.294-.16c.22.12.421.264.603.43-.08-.073-.159-.147-.238-.222.189.177.352.376.49.59l-.173-.27c.164.258.287.536.378.824l-.095-.308c.121.395.178.805.188 1.216L18.824 12c.01.56-.069 1.118-.212 1.66l.085-.322a7.83 7.83 0 0 1-.84 1.967l.165-.278c-.387.646-.513.902-1.06 1.434l.233-.225a8.504 8.504 0 0 1-.556.493c-.259.21-.444.497-.483.824a.891.891 0 0 0 .055.486.91.91 0 0 0 .22.426c.22.243.523.44.87.465.336.024.716-.029.98-.242l.187-.14Z"
                    ></path>
                    <path
                      fill="#FFDEB6"
                      d="M9.593 18.484a5.722 5.722 0 0 1-.29-.86 4.216 4.216 0 0 1-.116-.61 7.49 7.49 0 0 1-.04-.968c.004-.23.022-.461.053-.69.032-.24.079-.478.138-.713.087-.344.18-.687.302-1.02.217-.596.518-1.148.848-1.692a8.73 8.73 0 0 1 .963-1.296c.394-.439.827-.855 1.296-1.221a9.069 9.069 0 0 1 1.445-.907c.482-.248.987-.413 1.515-.552.498-.132.989-.164 1.505-.166.486 0 .966.097 1.426.243.175.056.343.127.505.212.26.137.518.274.747.456.23.184.452.39.642.613l.012.014a3.717 3.717 0 0 0-.274-.37 4.635 4.635 0 0 0-.643-.612 4.667 4.667 0 0 0-.747-.457 3.087 3.087 0 0 0-.505-.211 4.678 4.678 0 0 0-1.425-.243c-.517.001-1.008.034-1.506.165-.528.14-1.032.304-1.515.552a9.09 9.09 0 0 0-1.445.907c-.469.367-.902.783-1.295 1.221a8.729 8.729 0 0 0-.963 1.297c-.33.543-.632 1.096-.849 1.69a10.31 10.31 0 0 0-.301 1.022 5.931 5.931 0 0 0-.191 1.402 7.48 7.48 0 0 0 .039.97 5.722 5.722 0 0 0 .406 1.47 5.12 5.12 0 0 0 .645 1.023 4.685 4.685 0 0 1-.382-.669Z"
                    ></path>
                    <path
                      fill="#FFDEB6"
                      d="M16.425 18.348a.891.891 0 0 1-.054-.486c.04-.328.224-.614.483-.824.15-.122.295-.249.436-.38.378-.383.534-.63.784-1.049a7.938 7.938 0 0 0 .793-1.804c.105-.438.166-.884.172-1.332a4.468 4.468 0 0 0-.136-.885 3.497 3.497 0 0 0-.244-.54 3.049 3.049 0 0 0-.217-.27c.077.147.143.3.198.455.076.29.12.586.136.884a6.055 6.055 0 0 1-.172 1.332 7.9 7.9 0 0 1-.793 1.805c-.25.418-.406.666-.784 1.048a8.595 8.595 0 0 1-.436.38c-.26.21-.444.497-.483.825a.892.892 0 0 0 .054.485c.034.159.107.3.22.426.03.034.063.067.097.098a.896.896 0 0 1-.054-.168Zm-2.02.515a1.002 1.002 0 0 0-.17-.26c-.219-.242-.526-.445-.87-.466-.179-.01-.362.022-.539.005a3.2 3.2 0 0 1-.364-.144 3.035 3.035 0 0 1-.332-.239 2.956 2.956 0 0 1-.064-.068l.046.085c.085.119.178.232.28.339.105.087.216.166.332.239.119.055.24.103.365.144.177.017.36-.016.538-.006.298.018.569.173.778.371Z"
                    ></path>
                    <path
                      fill="#D45C27"
                      d="M18 21.382a1.253 1.253 0 0 0-.487-.832s-.423-.31-.968-.252c-.176.019-.339.08-.488.185a1.165 1.165 0 0 0-.43.369c-.222.31-.38.697-.346 1.067.012.132.061.574.466.876.358.268.772.255.954.235.534-.063.841-.414.938-.526.087-.099.452-.531.36-1.122Z"
                    ></path>
                    <path
                      fill="#FAA919"
                      d="M17.318 21.62c.21-.286.348-.628.293-.954a1.264 1.264 0 0 0-.487-.832 1.329 1.329 0 0 0-.967-.252c-.177.019-.34.08-.49.185a1.165 1.165 0 0 0-.429.368c-.222.312-.38.698-.346 1.067.036.366.181.682.466.877.271.18.661.23 1.02.14a1.31 1.31 0 0 0 .51-.23c.172-.091.315-.215.43-.368Z"
                    ></path>
                    <path
                      fill="#FFDEB6"
                      d="M15.022 21.464c-.035-.366.127-.752.351-1.065a1.21 1.21 0 0 1 .433-.372c.15-.107.314-.17.492-.192.34-.053.71.039.974.232.1.072.183.154.252.245a1.2 1.2 0 0 0-.377-.46 1.331 1.331 0 0 0-.968-.244c-.177.02-.34.083-.49.189a1.185 1.185 0 0 0-.432.37c-.225.313-.387.7-.354 1.07.022.236.09.45.213.625a1.413 1.413 0 0 1-.094-.398Z"
                    ></path>
                    <path
                      fill="#FFDEB6"
                      d="M15.898 20.229c-.27.177-.397.48-.277.663.123.177.45.159.724-.026.267-.173.374-.438.247-.607-.124-.175-.431-.196-.694-.03Z"
                      opacity=".4"
                    ></path>
                    <path
                      fill="#fff"
                      d="m22.259 15.595 1.71-.803c.512-.24.928-.631 1.185-1.113l.855-1.606a.342.342 0 0 1 .593 0l.854 1.605a2.58 2.58 0 0 0 1.186 1.114l1.71.803a.303.303 0 0 1 0 .557l-1.71.803c-.513.24-.93.631-1.186 1.113l-.855 1.606a.342.342 0 0 1-.592 0l-.855-1.606a2.577 2.577 0 0 0-1.186-1.113l-1.71-.803a.303.303 0 0 1 0-.557Z"
                    ></path>
                  </g>
                  <defs>
                    <clipPath id="a">
                      <path fill="#fff" d="M.5 0h31v31H.5z"></path>
                    </clipPath>
                  </defs>
                </svg>
                <p className="border font-bold q-amount-dark text-ds-light-500 text-lg pl-8 -ml-[1.6rem] pr-2 rounded-full">
                  500 coin
                </p>
              </div>
            </div>
            <div className="bg-black w-[200px] flex justify-center rounded-xl">
              <img
                src={hh}
                alt=""
                className="max-w-[130px] max-[505px]:max-w-[100px] rounded-xl"
              />
            </div>
          </div>
          <div className="bg-black pt-3 px-4 pb-[30px] rounded-xl mt-3">
            <div>
              <span className="text-xs font-medium">Câu đúng</span>
              <div className="relative flex mt-2">
                <div
                  className="accuracy-success-fill"
                  style={{ width: `calc(${roundedNumber}% - 2px)` }}
                ></div>
                <div
                  className="accuracy-danger-fill"
                  style={{ width: `calc(${totals}% - 2px)` }}
                ></div>
                <div
                  style={{ left: `calc(${roundedNumber}% - 18px)` }}
                  className="relative"
                >
                  <div className="accuracy flex items-center justify-center">
                    <div className="text-black text-xs ">{roundedNumber}%</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div className="flex items-center bg-black pt-2 px-4 pb-[10px] rounded-xl mt-3 justify-between">
            <div>
              <span className="text-[12px] font-medium">Tổng số</span>
              <br />
              <span className="text-[16px] font-medium">{total}</span>
            </div>
            <div
              className="w-8 h-[33px] flex items-center justify-center rounded-lg"
              style={{
                background:
                  " linear-gradient(135deg, #f5a623 0%, #f5a623b0 100%)",
              }}
            >
              <i className="fa-solid fa-coins"></i>
            </div>
          </div>
          <div className="actions-container ">
            <button className="w-full primary-action-btn mt-3">Chơi lại</button>
            <button className="w-full secondary-action-btn mt-3 mb-14">
              Tìm quiz mới
            </button>
          </div>

          <div className="text-center max-w-[480px] m-auto  relative">
            <span
              className="text-[16px] font-medium"
              style={{ color: "#ffffffa8" }}
            >
              Số liệu thống kê hiệu suất
            </span>
            <div className="flex font-bold mb-10">
              <div className="bg-black  stat-box-big correct-container relative">
                <div
                  className="bg-image"
                  style={{ backgroundPosition: "294px -713px" }}
                ></div>
                <div className=" text-3xl">{isquizz.countCorrect}</div>
                <div className=" text-xs" style={{ color: "#ffffffa8" }}>
                  Câu đúng
                </div>
              </div>
              <div className="stat-box-big bg-black  correct-container relative">
                <div
                  className="bg-image"
                  style={{ backgroundPosition: "-138px -597px" }}
                ></div>
                <div className="text-3xl">{causai}</div>
                <div className=" text-xs" style={{ color: "#ffffffa8" }}>
                  Câu sai
                </div>
              </div>
            </div>
          </div>
        </div>
        <div className="bg-black rounded-md pt-4 px-3 pb-6">
          <div>
            <span className="text-base">Xem lại Câu hỏi</span>
            <br />
            <span className="text-xs" style={{ color: "#ffffffa8" }}>
              Nhấp vào các câu hỏi để xem câu trả lời
            </span>
          </div>
          {location.state.data &&
            location.state.data.length > 0 &&
            location.state.data.map((item, index) => {
              return (
                <button
                  type="button"
                  key={index}
                  className={`question-container w-full p-3  rounded-lg ${
                    isquizz.quizData[index].isCorrect == true ? "dung" : "sai"
                  }  bg-white text-black mt-4 `}
                >
                  <div className="question-info-container pb-3">
                    <div className="question-text-wrapper without-image">
                      <div className="question-text items-center  color-black flex text-left text-base">
                        {index + 1}. &nbsp;
                        <img
                          src={`data:image/jpeg;base64,${item.img}`}
                          className="max-w-[100px]"
                          alt=""
                        />
                        <p className={`${item.img != null ? "pl-3" : ""} `}>
                          <strong>{item.questiondescription}</strong>
                        </p>
                      </div>
                    </div>
                  </div>
                  <hr />
                  <div className="options-container text-left mt-3">
                    <div className="option-container  full-width flex items-center ">
                      <span
                        key={`anss-${index}`}
                        className="option-text color-black "
                      >
                        {item.answers &&
                          item.answers.length > 0 &&
                          item.answers.map((answers, indexs) => {
                            return (
                              <>
                                <p className="text-[10px]">
                                  {answers.isSelect == false
                                    ? ""
                                    : "Your answers"}
                                </p>
                                <div
                                  className="flex py-1 items-center"
                                  key={`indexs${indexs}`}
                                >
                                  <div
                                    className={`bullet ${
                                      isquizz.quizData[index].systemAnswers[0]
                                        .id == answers.id
                                        ? "bg-green-300"
                                        : "bg-slate-200"
                                    } `}
                                  >
                                    {isquizz.quizData[index].systemAnswers[0]
                                      .id === answers.id ? (
                                      <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="16"
                                        height="16"
                                        fill="white"
                                        className="bi bi-check-lg -ml-[2px] -mt-[1px]"
                                        viewBox="0 0 16 16"
                                      >
                                        <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z" />
                                      </svg>
                                    ) : null}
                                  </div>

                                  <p className="text-base ">
                                    {answers.description}
                                  </p>
                                </div>
                              </>
                            );
                          })}
                      </span>
                    </div>
                  </div>
                </button>
              );
            })}
        </div>
      </div>
    </div>
  );
};

export default Summary;
